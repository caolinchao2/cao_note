import{_ as s,o as n,c as o,Q as a}from"./chunks/framework.b5309610.js";const u=JSON.parse('{"title":"浏览器缓存","description":"","frontmatter":{},"headers":[],"relativePath":"interview/浏览器/浏览器缓存.md","filePath":"interview/浏览器/浏览器缓存.md","lastUpdated":null}'),e={name:"interview/浏览器/浏览器缓存.md"},l=a(`<h1 id="浏览器缓存" tabindex="-1">浏览器缓存 <a class="header-anchor" href="#浏览器缓存" aria-label="Permalink to &quot;浏览器缓存&quot;">​</a></h1><h3 id="缓存位置" tabindex="-1">缓存位置 <a class="header-anchor" href="#缓存位置" aria-label="Permalink to &quot;缓存位置&quot;">​</a></h3><ul><li>内存缓存（memory cache） <ul><li>快速读取（内存缓存将编译解析后的文件，直接存入该进程的内存中，占据该进程一定的内存资源，以方便下次运行使用时的快速读取）</li><li>进程关闭时数据会被清除</li><li>不请求网络资源，资源存在内存中一般 <code>JS</code> 和图片文件会存入内存</li><li>状态码：<code>200（from memory cache）</code></li></ul></li><li>硬盘缓存（disk cache） <ul><li>写入硬盘文件进行 <code>I/O</code> 操作</li><li>进程关闭时数据不会被清除</li><li>速度比 <code>memory cache</code> 慢</li><li>不请求网络资源，资源存在磁盘中一般非脚本会存在磁盘中，如 <code>css</code></li><li>状态码：<code>200（from disk cache）</code></li></ul></li><li>代理服务器缓存（server worker） <ul><li>可以拦截处理页面的所有网络请求</li><li>仅 <code>HTTPS</code> 下可用、存在兼容问题</li><li>状态码：<code>200（from service worker）</code></li></ul></li></ul><blockquote><p>我们经常需要对业务中的一些数据进行存储，通常可以分为 短暂性存储 和 持久性储存。</p></blockquote><ul><li><p>短暂性的时候，我们只需要将数据存在内存中，只在运行时可用</p></li><li><p>持久性存储，可以分为 浏览器端 与 服务器端</p><ul><li><p>浏览器<code>cookie</code> 通常用于存储用户身份，登录状态等</p><ul><li><p><code>http</code> 中自动携带， 体积上限为 <code>4K</code>， 可自行设置过期时间</p></li><li><p><code>localStorage / sessionStorage</code>: 长久储存/窗口关闭删除， 体积限制为 <code>4~5M</code></p></li><li><p><code>indexDB</code></p></li></ul></li><li><p>服务器:</p><ul><li>分布式缓存 <code>redis</code></li></ul></li><li><p>数据库</p></li></ul></li></ul><blockquote><p>提示：如果平常有遇到过缓存的坑或者很好的利用缓存，可以讲解一下自己的使用场景。如果没有使用注意过缓存问题你也可以尝试讲解一下和我们息息相关的 Webpack 构建（每一次构建静态资源名称的<code>hash</code>值都会变化），它其实就跟缓存相关</p></blockquote><blockquote><p>缓存分为强缓存和协商缓存。强缓存不过服务器，协商缓存需要过服务器，协商缓存返回的状态码是 304。两类缓存机制可以同时存在，强缓存的优先级高于协商缓存。当执行强缓存时，如若缓存命中，则直接使用缓存数据库中的数据，不再进行缓存协商。</p></blockquote><h3 id="强缓存" tabindex="-1">强缓存 <a class="header-anchor" href="#强缓存" aria-label="Permalink to &quot;强缓存&quot;">​</a></h3><p><img src="https://s.poetries.work/uploads/2022/08/418cd4b22ded0606.png" alt="img"></p><p><strong>Expires(HTTP1.0)</strong>：<code>Exprires</code>的值为服务端返回的数据到期时间。当再次请求时的请求时间小于返回的此时间，则直接使用缓存数据。但由于服务端时间和客户端时间可能有误差，这也将导致缓存命中的误差。另一方面，Expires 是 HTTP1.0 的产物，故现在大多数使用<code>Cache-Control</code>替代</p><blockquote><p>缺点：使用的是绝对时间，如果服务端和客户端的时间产生偏差，那么会导致命中缓存产生偏差。</p></blockquote><p><strong>Cache-Control(HTTP1.1)</strong>：有很多属性，不同的属性代表的意义也不同</p><ul><li><code>private</code>：客户端可以缓存</li><li><code>public</code>：客户端和代理服务器都可以缓存</li><li><code>max-age=t</code>：缓存内容将在 t 秒后失效</li><li><code>no-cache</code>：需要使用协商缓存来验证缓存数据，可以在客户端存储资源，每次都必须去服务端做新鲜度校验，来决定从服务端获取新的资源（<code>200</code>）还是使用客户端缓存（<code>304</code>）</li><li><code>no-store</code>：所有内容都不会缓存，永远都不要在客户端存储资源，永远都去原始服务器去获取资源</li></ul><blockquote><p>请注意<code>no-cache</code>指令很多人误以为是不缓存，这是不准确的，<code>no-cache</code>的意思是可以缓存，但每次用应该去向服务器验证缓存是否可用。<code>no-store</code>才是不缓存内容。当在首部字段<code>Cache-Control</code> 有指定 <code>max-age</code> 指令时，比起首部字段 Expires，会优先处理 <code>max-age</code> 指令。命中强缓存的表现形式：Firefox 浏览器表现为一个灰色的 200 状态码。Chrome 浏览器状态码表现为 200 (<code>from disk cache</code>)或是 200 OK (<code>from memory cache</code>)</p></blockquote><h3 id="协商缓存-对比缓存" tabindex="-1">协商缓存（对比缓存） <a class="header-anchor" href="#协商缓存-对比缓存" aria-label="Permalink to &quot;协商缓存（对比缓存）&quot;">​</a></h3><blockquote><p>协商缓存需要进行对比判断是否可以使用缓存。浏览器第一次请求数据时，服务器会将缓存标识与数据一起响应给客户端，客户端将它们备份至缓存中。再次请求时，客户端会将缓存中的标识发送给服务器，服务器根据此标识判断。若未失效，返回 304 状态码，浏览器拿到此状态码就可以直接使用缓存数据了</p></blockquote><ul><li><code>Last-Modified</code>：服务器在响应请求时，会告诉浏览器资源的最后修改时间</li><li><code>if-Modified-Since</code>：浏览器再次请求服务器的时候，请求头会包含此字段，后面跟着在缓存中获得的最后修改时间。服务端收到此请求头发现有<code>if-Modified-Since</code>，则与被请求资源的最后修改时间进行对比，如果一致则返回 304 和响应报文头，浏览器只需要从缓存中获取信息即可</li><li>如果真的被修改：那么开始传输响应一个整体，服务器返回：<code>200 OK</code></li><li>如果没有被修改：那么只需传输响应<code>header</code>，服务器返回：<code>304 Not Modified</code></li><li><code>Etag</code>：服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）</li><li><code>If-Match</code>：条件请求，携带上一次请求中资源的<code>ETag</code>，服务器根据这个字段判断文件是否有新的修改</li><li><code>If-None-Match</code>： 再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现<code>If-None-Match</code>则与被请求资源的唯一标识进行对比。</li></ul><blockquote><p>但是实际应用中由于<code>Etag</code>的计算是使用算法来得出的，而算法会占用服务端计算的资源，所有服务端的资源都是宝贵的，所以就很少使用<code>Etag</code>了</p></blockquote><ul><li>浏览器地址栏中写入<code>URL</code>，回车浏览器发现缓存中有这个文件了，不用继续请求了，直接去缓存拿（最快）</li><li><code>F5</code>就是告诉浏览器，别偷懒，好歹去服务器看看这个文件是否有过期了。于是浏览器就胆胆襟襟的发送一个请求带上<code>If-Modify-since</code></li><li><code>Ctrl+F5</code>告诉浏览器，你先把你缓存中的这个文件给我删了，然后再去服务器请求个完整的资源文件下来。于是客户端就完成了强行更新的操作</li></ul><p>总结</p><ul><li>服务端判断客户端资源，是否和服务端资源一样。</li><li>一致则返回 <code>304</code>，否则返回 <code>200</code> 和最新的资源</li></ul><p><strong>资源标识：</strong></p><ul><li>在 <code>Response Headers</code> 中，有两种。</li><li><code>Last-Modified</code>：资源的最后修改时间。</li><li><code>Etag</code>：资源的唯一标识（一个字符串，类似于人类的指纹）</li></ul><p><img src="https://s.poetries.work/uploads/2022/08/4b918458db26d17b.png" alt="img"></p><blockquote><p>服务端拿到 <code>if-Modified-Since</code> 之后拿这个时间去和服务端资源最后修改时间做比较，如果一致则返回 <code>304</code> ，不一致（也就是资源已经更新了）就返回 200 和新的资源及新的 <code>Last-Modified</code></p></blockquote><p><img src="https://s.poetries.work/uploads/2022/08/aeec07248588bf72.png" alt="img"></p><blockquote><p>其实 <code>Etag</code> 和 <code>Last-Modified</code> 一样的，只不过 <code>Etag</code> 是服务端对资源按照一定方式（比如 <code>contenthash</code>）计算出来的唯一标识，就像人类指纹一样，传给客户端之后，客户端再传过来时候，服务端会将其与现在的资源计算出来的唯一标识做比较，一致则返回 <code>304</code>，不一致就返回 <code>200</code> 和新的资源及新的 <code>Etag</code></p></blockquote><p><strong>两者比较：</strong></p><ul><li>优先使用 <code>Etag</code>。</li><li><code>Last-Modified</code> 只能精确到秒级。</li><li>如果资源被重复生成，而内容不变，则 <code>Etag</code> 更精确。</li></ul><p><img src="https://s.poetries.work/uploads/2022/08/1d8b9e11dbaca97f.png" alt="img"></p><p><strong>三种刷新操作对 http 缓存的影响</strong></p><ul><li>正常操作：地址栏输入 <code>url</code>，跳转链接，前进后退等</li><li>手动刷新：<code>f5</code>，点击刷新按钮，右键菜单刷新</li><li>强制刷新：<code>ctrl + f5</code>，<code>shift+command+r</code></li></ul><blockquote><ul><li><strong>正常操作</strong>：强制缓存有效，协商缓存有效</li><li><strong>手动刷新</strong>：强制缓存失效，协商缓存有效</li><li><strong>强制刷新</strong>：强制缓存失效，协商缓存失效</li></ul></blockquote><h3 id="缓存场景" tabindex="-1">缓存场景 <a class="header-anchor" href="#缓存场景" aria-label="Permalink to &quot;缓存场景&quot;">​</a></h3><blockquote><p>对于大部分的场景都可以使用强缓存配合协商缓存解决，但是在一些特殊的地方可能需要选择特殊的缓存策</p></blockquote><ul><li>对于某些不需要缓存的资源，可以使用 <code>Cache-control: no-store</code> ，表示该资源不需要缓存</li><li>对于频繁变动的资源，可以使用 <code>Cache-Control: no-cache</code> 并配合 <code>ETag</code> 使用，表示该资源已被缓存，但是每次都会发送请求询问资源是否更新</li><li>对于代码文件来说，通常使用 <code>Cache-Control: max-age=31536000</code> 并配合策略缓存使用，然后对文件进行指纹处理，一旦文件名变动就会立刻下载新的文件</li></ul><h3 id="讲讲-304" tabindex="-1">讲讲 304 <a class="header-anchor" href="#讲讲-304" aria-label="Permalink to &quot;讲讲 304&quot;">​</a></h3><blockquote><p>如果客户端发送了一个带条件的 <code>GET</code> 请求且该请求已被允许，而文档的内容(自上次访问以来或者根据请求的条件)并没有改变，则服务器应当返回这个 <code>304</code> 状态码</p></blockquote><h3 id="强缓存、协商缓存什么时候用哪个" tabindex="-1">强缓存、协商缓存什么时候用哪个 <a class="header-anchor" href="#强缓存、协商缓存什么时候用哪个" aria-label="Permalink to &quot;强缓存、协商缓存什么时候用哪个&quot;">​</a></h3><blockquote><p>因为服务器上的资源不是一直固定不变的，大多数情况下它会更新，这个时候如果我们 还访问本地缓存，那么对用户来说，那就相当于资源没有更新，用户看到的还是旧的资 源;所以我们希望服务器上的资源更新了浏览器就请求新的资源，没有更新就使用本地 的缓存，以最大程度的减少因网络请求而产生的资源浪费。</p></blockquote><h3 id="缓存总结" tabindex="-1">缓存总结 <a class="header-anchor" href="#缓存总结" aria-label="Permalink to &quot;缓存总结&quot;">​</a></h3><blockquote><p>缓存分为两种:强缓存和协商缓存，根据响应的 <code>header</code> 内容来决定。</p></blockquote><table><thead><tr><th></th><th>获取资源形式</th><th>状态码</th><th>发送请求到服务器</th></tr></thead><tbody><tr><td>强缓存</td><td>从缓存取</td><td><code>200(from cache)</code></td><td>否，直接从缓存取</td></tr><tr><td>协商缓存</td><td>从缓存取</td><td><code>304(not modified)</code></td><td>是，通过服务器来告知缓存是否可 用</td></tr></tbody></table><ul><li>强缓存相关字段有 <code>expires</code>，<code>cache-control</code>。如果 <code>cache-control</code> 与 <code>expires</code> 同时存在的话， <code>cache-control</code> 的优先级高于 <code>expires</code>。</li><li>协商缓存相关字段有 <code>Last-Modified/If-Modified-Since</code>，<code>Etag/If-None-Match</code></li></ul><h3 id="cookie-和-localsrorage、session、indexdb-的区别" tabindex="-1">cookie 和 localSrorage、session、indexDB 的区别 <a class="header-anchor" href="#cookie-和-localsrorage、session、indexdb-的区别" aria-label="Permalink to &quot;cookie 和 localSrorage、session、indexDB 的区别&quot;">​</a></h3><table><thead><tr><th>特性</th><th>cookie</th><th>localStorage</th><th>sessionStorage</th><th>indexDB</th></tr></thead><tbody><tr><td>数据生命周期</td><td>一般由服务器生成，可以设置过期时间</td><td>除非被清理，否则一直存在</td><td>页面关闭就清理</td><td>除非被清理，否则一直存在</td></tr><tr><td>数据存储大小</td><td><code>4K</code></td><td><code>5M</code></td><td><code>5M</code></td><td>无限</td></tr><tr><td>与服务端通信</td><td>每次都会携带在 <code>header</code> 中，对于请求性能影响</td><td>不参与</td><td>不参与</td><td>不参与</td></tr></tbody></table><blockquote><p>从上表可以看到，<code>cookie</code> 已经不建议用于存储。如果没有大量数据存储需求的话，可以使用 <code>localStorage</code>和 <code>sessionStorage</code> 。对于不怎么改变的数据尽量使用 <code>localStorage</code> 存储，否则可以用 <code>sessionStorage</code> 存储。</p></blockquote><p><strong>对于 <code>cookie</code>，我们还需要注意安全性</strong></p><table><thead><tr><th>属性</th><th>作用</th></tr></thead><tbody><tr><td><code>value</code></td><td>如果用于保存用户登录态，应该将该值加密，不能使用明文的用户标识</td></tr><tr><td><code>http-only</code></td><td>不能通过 <code>JS</code>访问 <code>Cookie</code>，减少 <code>XSS</code>攻击</td></tr><tr><td><code>secure</code></td><td>只能在协议为 <code>HTTPS</code> 的请求中携带</td></tr><tr><td><code>same-site</code></td><td>规定浏览器不能在跨域请求中携带 <code>Cookie</code>，减少 <code>CSRF</code> 攻击</td></tr></tbody></table><h4 id="indexeddb" tabindex="-1">IndexedDB <a class="header-anchor" href="#indexeddb" aria-label="Permalink to &quot;IndexedDB&quot;">​</a></h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API" target="_blank" rel="noreferrer">IndexedDB</a> 是一个运行在浏览器上的非关系型数据库，用于<strong>在客户端存储大量结构化数据</strong></p><div class="tip custom-block"><p class="custom-block-title">IndexedDB 的特点</p><ul><li>存储空间大(一般来说不少于 <code>250MB</code> 甚至没有上限)</li><li>支持存储二进制数据(<code>ArrayBuffer</code> 和 <code>Blob</code>)</li><li>键值对储存</li><li>同源限制</li><li>执行的操作是异步执行，以免阻塞应用程序</li><li>是一个事务型数据库系统</li></ul></div><h4 id="api-使用" tabindex="-1">API 使用 <a class="header-anchor" href="#api-使用" aria-label="Permalink to &quot;API 使用&quot;">​</a></h4><p>打开/创建一个 IndexedDB 数据库，并指定数据库的版本号 (版本号只能为整数)</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">request</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> window.indexedDB.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;myDatabase&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 成功回调</span></span>
<span class="line"><span style="color:#E1E4E8;">request.</span><span style="color:#B392F0;">onsuccess</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 获取 indexedDB 实例</span></span>
<span class="line"><span style="color:#E1E4E8;">  db </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> event.target.result</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 也可以使用 request.result 获取 indexedDB 实例</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;连接 IndexedDB 成功&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 失败回调</span></span>
<span class="line"><span style="color:#E1E4E8;">request.</span><span style="color:#B392F0;">onerror</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;连接 IndexedDB 失败&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">request</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> window.indexedDB.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;myDatabase&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 成功回调</span></span>
<span class="line"><span style="color:#24292E;">request.</span><span style="color:#6F42C1;">onsuccess</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 获取 indexedDB 实例</span></span>
<span class="line"><span style="color:#24292E;">  db </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> event.target.result</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 也可以使用 request.result 获取 indexedDB 实例</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;连接 IndexedDB 成功&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 失败回调</span></span>
<span class="line"><span style="color:#24292E;">request.</span><span style="color:#6F42C1;">onerror</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;连接 IndexedDB 失败&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>创建一个对象仓库(类似于数据库中的表)</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// upgradeneeded 事件会在初始化数据库或版本发生更新时被调用</span></span>
<span class="line"><span style="color:#E1E4E8;">request.</span><span style="color:#B392F0;">onupgradeneeded</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">db</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> event.target.result</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 创建对象仓库并指定主键</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> db.</span><span style="color:#B392F0;">createObjectStore</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    keyPath: </span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    autoIncrement: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;创建对象仓库成功&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">   * 定义存储对象的数据项</span></span>
<span class="line"><span style="color:#6A737D;">   * 第一个参数是创建的索引名称，可以为空</span></span>
<span class="line"><span style="color:#6A737D;">   * 第二个参数是索引使用的关键名称，可以为空</span></span>
<span class="line"><span style="color:#6A737D;">   * 第三个参数是可选配置参数，可以不传，常用参数之一就是 unique ，表示该字段是否唯一，不能重复</span></span>
<span class="line"><span style="color:#6A737D;">   */</span></span>
<span class="line"><span style="color:#E1E4E8;">  objectStore.</span><span style="color:#B392F0;">createIndex</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    unique: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">  objectStore.</span><span style="color:#B392F0;">createIndex</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;name&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;name&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// upgradeneeded 事件会在初始化数据库或版本发生更新时被调用</span></span>
<span class="line"><span style="color:#24292E;">request.</span><span style="color:#6F42C1;">onupgradeneeded</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">db</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> event.target.result</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 创建对象仓库并指定主键</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> db.</span><span style="color:#6F42C1;">createObjectStore</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">    keyPath: </span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    autoIncrement: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  })</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;创建对象仓库成功&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">   * 定义存储对象的数据项</span></span>
<span class="line"><span style="color:#6A737D;">   * 第一个参数是创建的索引名称，可以为空</span></span>
<span class="line"><span style="color:#6A737D;">   * 第二个参数是索引使用的关键名称，可以为空</span></span>
<span class="line"><span style="color:#6A737D;">   * 第三个参数是可选配置参数，可以不传，常用参数之一就是 unique ，表示该字段是否唯一，不能重复</span></span>
<span class="line"><span style="color:#6A737D;">   */</span></span>
<span class="line"><span style="color:#24292E;">  objectStore.</span><span style="color:#6F42C1;">createIndex</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">    unique: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  })</span></span>
<span class="line"><span style="color:#24292E;">  objectStore.</span><span style="color:#6F42C1;">createIndex</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;name&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;name&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>添加数据</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 创建事务指并定表格名称和读写权限</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">transaction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> db.</span><span style="color:#B392F0;">transaction</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&#39;readwrite&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">// 获取 Object Store 对象</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> transaction.</span><span style="color:#B392F0;">objectStore</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/* 添加数据 */</span></span>
<span class="line"><span style="color:#E1E4E8;">objectStore.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">({ id: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, name: </span><span style="color:#9ECBFF;">&#39;test&#39;</span><span style="color:#E1E4E8;"> })</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 创建事务指并定表格名称和读写权限</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">transaction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> db.</span><span style="color:#6F42C1;">transaction</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&#39;readwrite&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;">// 获取 Object Store 对象</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> transaction.</span><span style="color:#6F42C1;">objectStore</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/* 添加数据 */</span></span>
<span class="line"><span style="color:#24292E;">objectStore.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">({ id: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, name: </span><span style="color:#032F62;">&#39;test&#39;</span><span style="color:#24292E;"> })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>获取数据</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">transaction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> db.</span><span style="color:#B392F0;">transaction</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&#39;readonly&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> transaction.</span><span style="color:#B392F0;">objectStore</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStoreRequest</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> objectStore.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">objectStoreRequest.</span><span style="color:#B392F0;">onsuccess</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;获取数据&#39;</span><span style="color:#E1E4E8;">, objectStoreRequest.result)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">transaction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> db.</span><span style="color:#6F42C1;">transaction</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&#39;readonly&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> transaction.</span><span style="color:#6F42C1;">objectStore</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStoreRequest</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> objectStore.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">objectStoreRequest.</span><span style="color:#6F42C1;">onsuccess</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;获取数据&#39;</span><span style="color:#24292E;">, objectStoreRequest.result)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>修改数据</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">transaction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> db.</span><span style="color:#B392F0;">transaction</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&#39;readwrite&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> transaction.</span><span style="color:#B392F0;">objectStore</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStoreRequest</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> objectStore.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">objectStoreRequest.</span><span style="color:#B392F0;">onsuccess</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> objectStoreRequest.result</span></span>
<span class="line"><span style="color:#E1E4E8;">  data.name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;maomao&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  objectStore.</span><span style="color:#B392F0;">put</span><span style="color:#E1E4E8;">(data)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">transaction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> db.</span><span style="color:#6F42C1;">transaction</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&#39;readwrite&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> transaction.</span><span style="color:#6F42C1;">objectStore</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStoreRequest</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> objectStore.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">objectStoreRequest.</span><span style="color:#6F42C1;">onsuccess</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> objectStoreRequest.result</span></span>
<span class="line"><span style="color:#24292E;">  data.name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;maomao&#39;</span></span>
<span class="line"><span style="color:#24292E;">  objectStore.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(data)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>删除数据</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">transaction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> db.</span><span style="color:#B392F0;">transaction</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&#39;readwrite&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> transaction.</span><span style="color:#B392F0;">objectStore</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;userInfo&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">objectStoreRequest</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> objectStore.</span><span style="color:#B392F0;">delete</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">objectStoreRequest.</span><span style="color:#B392F0;">onsuccess</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> () {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;删除成功&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">transaction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> db.</span><span style="color:#6F42C1;">transaction</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&#39;readwrite&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> transaction.</span><span style="color:#6F42C1;">objectStore</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;userInfo&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">objectStoreRequest</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> objectStore.</span><span style="color:#6F42C1;">delete</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">objectStoreRequest.</span><span style="color:#6F42C1;">onsuccess</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> () {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;删除成功&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">在日常开发中可以使用如下类库简化代码量</p><ul><li><a href="https://github.com/localForage/localForage" target="_blank" rel="noreferrer">localForage</a> 一个提供 <code>name:value</code> 的简单语法的客户端数据存储垫片，基于 <code>IndexedDB</code> 实现，并在不持支 <code>IndexedDB</code> 的浏览器中自动回退到 <code>WebSQL</code> 和 <code>localStorage</code></li><li><a href="https://github.com/dexie/Dexie.js" target="_blank" rel="noreferrer">Dexie.js</a> 对 <code>IndexedDB</code> 的封装，通过提供更友好和简单语法进行快速的编码开发</li><li><a href="https://github.com/pouchdb/pouchdb" target="_blank" rel="noreferrer">PouchDB</a> 对 <code>IndexedDB</code> 的封装，通过提供更友好和简单语法进行快速的编码开发</li></ul></div><h3 id="什么是-cookie" tabindex="-1">什么是 Cookie <a class="header-anchor" href="#什么是-cookie" aria-label="Permalink to &quot;什么是 Cookie&quot;">​</a></h3><ul><li><strong>HTTP 是无状态的协议</strong>（对于事务处理没有记忆能力，每次客户端和服务端会话完成时，服务端不会保存任何会话信息）：每个请求都是完全独立的，服务端无法确认当前访问者的身份信息，无法分辨上一次的请求发送者和这一次的发送者是不是同一个人。所以服务器与浏览器为了进行会话跟踪（知道是谁在访问我），就必须主动的去维护一个状态，这个状态用于告知服务端前后两个请求是否来自同一浏览器。而这个状态需要通过 <code>cookie</code> 或者 <code>session</code> 去实现</li><li><strong>cookie 存储在客户端</strong>： <code>cookie</code> 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上</li><li><strong>cookie 是不可跨域的</strong>： 每个 <code>cookie</code> 都会绑定单一的域名，无法在别的域名下获取使用，<strong>一级域名和二级域名之间是允许共享使用的</strong>（靠的是 <code>domain</code>）</li></ul><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><code>name=value</code></td><td>键值对，设置 <code>Cookie</code> 的名称及相对应的值，都必须是字符串类型。如果值为 <code>Unicode</code> 字符，需要为字符编码。如果值为二进制数据，则需要使用 <code>BASE64</code> 编码。</td></tr><tr><td><code>domain</code></td><td>指定 <code>cookie</code> 所属域名，默认是当前域名</td></tr><tr><td><code>path</code></td><td>指定 <code>cookie</code> 在哪个路径（路由）下生效，默认是 <code>&#39;/&#39;</code>。如果设置为 <code>/abc</code>，则只有 <code>/abc</code> 下的路由可以访问到该 <code>cookie</code>，如：<code>/abc/read</code>。</td></tr><tr><td><code>maxAge</code></td><td><code>cookie</code> 失效的时间，单位秒。如果为整数，则该 <code>cookie</code> 在 <code>maxAge</code> 秒后失效。如果为负数，该 <code>cookie</code> 为临时 <code>cookie</code> ，关闭浏览器即失效，浏览器也不会以任何形式保存该 <code>cookie</code> 。如果为 <code>0</code>，表示删除该 <code>cookie</code> 。默认为 <code>-1</code>。- 比 <code>expires</code> 好用。</td></tr><tr><td><code>expires</code></td><td>过期时间，在设置的某个时间点后该 <code>cookie</code> 就会失效。一般浏览器的 <code>cookie</code> 都是默认储存的，当关闭浏览器结束这个会话的时候，这个 <code>cookie</code> 也就会被删除</td></tr><tr><td><code>secure</code></td><td>该 cookie 是否仅被使用安全协议传输。安全协议有 <code>HTTPS</code>，<code>SSL</code>等，在网络上传输数据之前先将数据加密。默认为<code>false</code>。当 <code>secure</code> 值为 <code>true</code> 时，<code>cookie</code> 在 <code>HTTP</code> 中是无效，在 <code>HTTPS</code> 中才有效</td></tr><tr><td><code>httpOnly</code></td><td>如果给某个 <code>cookie</code> 设置了 <code>httpOnly</code> 属性，则无法通过 JS 脚本 读取到该 <code>cookie</code> 的信息，但还是能通过 <code>Application</code> 中手动修改 <code>cookie</code>，所以只是在一定程度上可以防止 <code>XSS</code> 攻击，不是绝对的安全</td></tr></tbody></table><h3 id="什么是-session" tabindex="-1">什么是 Session <a class="header-anchor" href="#什么是-session" aria-label="Permalink to &quot;什么是 Session&quot;">​</a></h3><ul><li><code>session</code> 是另一种记录服务器和客户端会话状态的机制</li><li><code>session</code> 是基于 <code>cookie</code> 实现的，<code>session</code> 存储在服务器端，<code>sessionId</code> 会被存储到客户端的<code>cookie</code> 中</li></ul><p><img src="https://s.poetries.work/uploads/2022/08/053ef73d5751267e.png" alt="img"></p><p><strong>session 认证流程：</strong></p><ul><li>用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建对应的 <code>Session</code></li><li>请求返回时将此 <code>Session</code> 的唯一标识信息 <code>SessionID</code> 返回给浏览器</li><li>浏览器接收到服务器返回的 <code>SessionID</code> 信息后，会将此信息存入到 <code>Cookie</code> 中，同时 <code>Cookie</code> 记录此 <code>SessionID</code> 属于哪个域名</li><li>当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 <code>Cookie</code> 信息，如果存在自动将 <code>Cookie</code> 信息也发送给服务端，服务端会从 <code>Cookie</code> 中获取 <code>SessionID</code>，再根据 <code>SessionID</code> 查找对应的 <code>Session</code> 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 <code>Session</code> 证明用户已经登录可执行后面操作。</li></ul><blockquote><p>根据以上流程可知，<code>SessionID</code> 是连接 <code>Cookie</code> 和 <code>Session</code> 的一道桥梁，大部分系统也是根据此原理来验证用户登录状态。</p></blockquote><h3 id="cookie-和-session-的区别" tabindex="-1">Cookie 和 Session 的区别 <a class="header-anchor" href="#cookie-和-session-的区别" aria-label="Permalink to &quot;Cookie 和 Session 的区别&quot;">​</a></h3><ul><li><strong>安全性</strong>： <code>Session</code> 比 <code>Cookie</code> 安全，<code>Session</code> 是存储在服务器端的，<code>Cookie</code> 是存储在客户端的。</li><li><strong>存取值的类型不同</strong>：Cookie 只支持存字符串数据，想要设置其他类型的数据，需要将其转换成字符串，<code>Session</code> 可以存任意数据类型。</li><li><strong>有效期不同</strong>： <code>Cookie</code> 可设置为长时间保持，比如我们经常使用的默认登录功能，<code>Session</code> 一般失效时间较短，客户端关闭（默认情况下）或者 <code>Session</code> 超时都会失效。</li><li><strong>存储大小不同</strong>： 单个 <code>Cookie</code> 保存的数据不能超过 <code>4K</code>，<code>Session</code> 可存储数据远高于 <code>Cookie</code>，但是当访问量过多，会占用过多的服务器资源。</li></ul>`,77),p=[l];function c(t,r,d,i,E,y){return n(),o("div",null,p)}const F=s(e,[["render",c]]);export{u as __pageData,F as default};
