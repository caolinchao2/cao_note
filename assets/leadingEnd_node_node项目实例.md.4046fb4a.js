import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.b5309610.js";const F=JSON.parse('{"title":"node项目实例","description":"","frontmatter":{},"headers":[],"relativePath":"leadingEnd/node/node项目实例.md","filePath":"leadingEnd/node/node项目实例.md","lastUpdated":null}'),p={name:"leadingEnd/node/node项目实例.md"},o=l(`<h1 id="node项目实例" tabindex="-1">node项目实例 <a class="header-anchor" href="#node项目实例" aria-label="Permalink to &quot;node项目实例&quot;">​</a></h1><p>博客项目简介：基于Node.js+Express+Mongodb+Mongoose开发</p><h2 id="一、创建文件夹" tabindex="-1">一、创建文件夹： <a class="header-anchor" href="#一、创建文件夹" aria-label="Permalink to &quot;一、创建文件夹：&quot;">​</a></h2><p>项目目录：my_blog</p><p>app.js入口文件</p><p>views：视图模板</p><p>static：存放静态资源</p><p>controller：控制路由</p><p>models：使用db的模板</p><p>libs：后端使用</p><p>uploads：接收上传的图片文件夹</p><h2 id="二、下载模板" tabindex="-1">二、下载模板 <a class="header-anchor" href="#二、下载模板" aria-label="Permalink to &quot;二、下载模板&quot;">​</a></h2><p><a href="http://www.cssmoban.com/cssthemes/8138.shtml" target="_blank" rel="noreferrer">http://www.cssmoban.com/cssthemes/8138.shtml</a></p><h2 id="三、下载第三方包" tabindex="-1">三、下载第三方包 <a class="header-anchor" href="#三、下载第三方包" aria-label="Permalink to &quot;三、下载第三方包&quot;">​</a></h2><ol><li>根据项目需求，下载所需的第三方包；</li></ol><p>express、mongoose、ejs、formidable(表单)、uuid(图名)</p><h2 id="四、设计路由" tabindex="-1">四、设计路由 <a class="header-anchor" href="#四、设计路由" aria-label="Permalink to &quot;四、设计路由&quot;">​</a></h2><ol><li>根据需求设计路由，并将html模板中相同的部分使用ejs模板引入；</li></ol><p>（可以先设计登录页面，之后判断是否登录，才能发表文章）</p><h2 id="六、添加数据库" tabindex="-1">六、添加数据库 <a class="header-anchor" href="#六、添加数据库" aria-label="Permalink to &quot;六、添加数据库&quot;">​</a></h2><ol><li>连接：</li></ol><p>（1）在libs文件夹创建一个专门连接的js文件</p><p>（2）里面只引入mongoose和连接，</p><p>（3）之后在app.js头部引入；</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./libs/connectdb.js&#39;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./libs/connectdb.js&#39;</span><span style="color:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>创建db</li></ol><p>（1）在models创建一个文章db；</p><p>（2）定义Schema约束</p><p>（3）定义一个添加文章的函数，两个形参（传入的值，回调函数）；</p><p>（4）如果添加出错return callback(err)，如果成功return callback(null);</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 添加时间：</span></span>
<span class="line"><span style="color:#B392F0;">addtime</span><span style="color:#E1E4E8;">:{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">:Date,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">:Date.now</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">addArticle</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">callback</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    models.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">(data,(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//添加成功</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{  </span><span style="color:#6A737D;">//添加失败   返回null方便判断</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 添加时间：</span></span>
<span class="line"><span style="color:#6F42C1;">addtime</span><span style="color:#24292E;">:{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">:Date,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">default</span><span style="color:#24292E;">:Date.now</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">addArticle</span><span style="color:#24292E;">(</span><span style="color:#E36209;">data</span><span style="color:#24292E;">,</span><span style="color:#E36209;">callback</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    models.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">(data,(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//添加成功</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{  </span><span style="color:#6A737D;">//添加失败   返回null方便判断</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="3"><li>处理数据</li></ol><p>（1）处理拿到的数据，引入数据文件；</p><p>（2）在添加文章路由文件引入设计的db模块；</p><p>（3）将图片的路径添加到fields对象中，再添加一个用户id，获取哪个用户上传的；</p><p>（4）将fields对象作为实参调用添加文章的函数</p><p>（5）处理添加成功或者失败；</p><p>（5）使用ejs模板往前台传入数据；</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fields.uname </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> uname;  </span><span style="color:#6A737D;">//设计一个用户名，方便后期渲染</span></span>
<span class="line"><span style="color:#E1E4E8;">fields.pic </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> picName;  </span><span style="color:#6A737D;">//往fields里面添加属性;</span></span>
<span class="line"><span style="color:#E1E4E8;">articleDB.</span><span style="color:#B392F0;">addArticle</span><span style="color:#E1E4E8;">(fields,</span><span style="color:#FFAB70;">result</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(result){  </span><span style="color:#6A737D;">//处理添加失败</span></span>
<span class="line"><span style="color:#E1E4E8;">        res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;msg.html&#39;</span><span style="color:#E1E4E8;">,{curtitle:</span><span style="color:#9ECBFF;">&#39;上传失败&#39;</span><span style="color:#E1E4E8;">,curUrl:</span><span style="color:#9ECBFF;">&#39;/user/publish&#39;</span><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{  </span><span style="color:#6A737D;">//处理添加成功</span></span>
<span class="line"><span style="color:#E1E4E8;">        res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;msg.html&#39;</span><span style="color:#E1E4E8;">,{curtitle:</span><span style="color:#9ECBFF;">&#39;上传成功&#39;</span><span style="color:#E1E4E8;">,curUrl:</span><span style="color:#9ECBFF;">&#39;/user/publish&#39;</span><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fields.uname </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> uname;  </span><span style="color:#6A737D;">//设计一个用户名，方便后期渲染</span></span>
<span class="line"><span style="color:#24292E;">fields.pic </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> picName;  </span><span style="color:#6A737D;">//往fields里面添加属性;</span></span>
<span class="line"><span style="color:#24292E;">articleDB.</span><span style="color:#6F42C1;">addArticle</span><span style="color:#24292E;">(fields,</span><span style="color:#E36209;">result</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(result){  </span><span style="color:#6A737D;">//处理添加失败</span></span>
<span class="line"><span style="color:#24292E;">        res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;msg.html&#39;</span><span style="color:#24292E;">,{curtitle:</span><span style="color:#032F62;">&#39;上传失败&#39;</span><span style="color:#24292E;">,curUrl:</span><span style="color:#032F62;">&#39;/user/publish&#39;</span><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;">    }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{  </span><span style="color:#6A737D;">//处理添加成功</span></span>
<span class="line"><span style="color:#24292E;">        res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;msg.html&#39;</span><span style="color:#24292E;">,{curtitle:</span><span style="color:#032F62;">&#39;上传成功&#39;</span><span style="color:#24292E;">,curUrl:</span><span style="color:#032F62;">&#39;/user/publish&#39;</span><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>数据库结构：创建models文件</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mongoose</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;mongoose&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//约束规则</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> Schemas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> mongoose.</span><span style="color:#B392F0;">Schema</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    uname:String,</span></span>
<span class="line"><span style="color:#E1E4E8;">    title:String,</span></span>
<span class="line"><span style="color:#E1E4E8;">    desc:String,</span></span>
<span class="line"><span style="color:#E1E4E8;">    contents:String,</span></span>
<span class="line"><span style="color:#E1E4E8;">    pic:String,</span></span>
<span class="line"><span style="color:#E1E4E8;">    del:{</span></span>
<span class="line"><span style="color:#E1E4E8;">        type:Number,</span></span>
<span class="line"><span style="color:#E1E4E8;">        default:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">//1为显示  0为删除;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    addtime:{</span></span>
<span class="line"><span style="color:#E1E4E8;">        type:Date,</span></span>
<span class="line"><span style="color:#E1E4E8;">        default:Date.now</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//定义模型</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> models </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> mongoose.</span><span style="color:#B392F0;">model</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;article&#39;</span><span style="color:#E1E4E8;">,Schemas);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//定义添加文章</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">addArticle</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">callback</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    models.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">(data,(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//添加成功</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{  </span><span style="color:#6A737D;">//添加失败</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//定义查询文章并渲染</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">findArticle</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">conditions</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">projection</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">callback</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    models.</span><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;">(conditions,projection,options,(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">docs</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//查询失败;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(err,[])</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{   </span><span style="color:#6A737D;">//查询成功</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">,docs);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//查询条数</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">findCount</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">callback</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    models.</span><span style="color:#B392F0;">countDocuments</span><span style="color:#E1E4E8;">(data,(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">cond</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){   </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(err,</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">,cond);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">updateArticle</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">id</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">update</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">ccc</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">callback</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    models.</span><span style="color:#B392F0;">findByIdAndUpdate</span><span style="color:#E1E4E8;">(id,update,ccc,</span><span style="color:#FFAB70;">err</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//将文章暴露出去;</span></span>
<span class="line"><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {addArticle,findArticle,findCount,updateArticle}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mongoose</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;mongoose&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//约束规则</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> Schemas </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> mongoose.</span><span style="color:#6F42C1;">Schema</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    uname:String,</span></span>
<span class="line"><span style="color:#24292E;">    title:String,</span></span>
<span class="line"><span style="color:#24292E;">    desc:String,</span></span>
<span class="line"><span style="color:#24292E;">    contents:String,</span></span>
<span class="line"><span style="color:#24292E;">    pic:String,</span></span>
<span class="line"><span style="color:#24292E;">    del:{</span></span>
<span class="line"><span style="color:#24292E;">        type:Number,</span></span>
<span class="line"><span style="color:#24292E;">        default:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">//1为显示  0为删除;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    addtime:{</span></span>
<span class="line"><span style="color:#24292E;">        type:Date,</span></span>
<span class="line"><span style="color:#24292E;">        default:Date.now</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//定义模型</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> models </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> mongoose.</span><span style="color:#6F42C1;">model</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;article&#39;</span><span style="color:#24292E;">,Schemas);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//定义添加文章</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">addArticle</span><span style="color:#24292E;">(</span><span style="color:#E36209;">data</span><span style="color:#24292E;">,</span><span style="color:#E36209;">callback</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    models.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">(data,(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//添加成功</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{  </span><span style="color:#6A737D;">//添加失败</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//定义查询文章并渲染</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">findArticle</span><span style="color:#24292E;">(</span><span style="color:#E36209;">conditions</span><span style="color:#24292E;">,</span><span style="color:#E36209;">projection</span><span style="color:#24292E;">,</span><span style="color:#E36209;">options</span><span style="color:#24292E;">,</span><span style="color:#E36209;">callback</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    models.</span><span style="color:#6F42C1;">find</span><span style="color:#24292E;">(conditions,projection,options,(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">docs</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//查询失败;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(err,[])</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{   </span><span style="color:#6A737D;">//查询成功</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,docs);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//查询条数</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">findCount</span><span style="color:#24292E;">(</span><span style="color:#E36209;">data</span><span style="color:#24292E;">,</span><span style="color:#E36209;">callback</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    models.</span><span style="color:#6F42C1;">countDocuments</span><span style="color:#24292E;">(data,(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">cond</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){   </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(err,</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,cond);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">updateArticle</span><span style="color:#24292E;">(</span><span style="color:#E36209;">id</span><span style="color:#24292E;">,</span><span style="color:#E36209;">update</span><span style="color:#24292E;">,</span><span style="color:#E36209;">ccc</span><span style="color:#24292E;">,</span><span style="color:#E36209;">callback</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    models.</span><span style="color:#6F42C1;">findByIdAndUpdate</span><span style="color:#24292E;">(id,update,ccc,</span><span style="color:#E36209;">err</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//将文章暴露出去;</span></span>
<span class="line"><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {addArticle,findArticle,findCount,updateArticle}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>路由结构：创建ArticleRouter.js,之后在app.js引入</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">express</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;express&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> router </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> express.</span><span style="color:#B392F0;">Router</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Articledb</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;../models/Articledb.js&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//博客首页</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    Articledb.</span><span style="color:#B392F0;">findArticle</span><span style="color:#E1E4E8;">({del:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">},{},{limit:</span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">,sort:{addtime:</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">}},(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">docs</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Not Found：&#39;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">err);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }   </span><span style="color:#6A737D;">//查询成功..</span></span>
<span class="line"><span style="color:#E1E4E8;">        res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index-index.html&#39;</span><span style="color:#E1E4E8;">,{docs})</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//博客列表页</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/lists/:pid&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//定义每页显示的条数</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> limits </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//定义每页跳过多少条</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> skips </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (req.params.pid</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">limits;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//查询条数</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> pagenum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    Articledb.</span><span style="color:#B392F0;">findCount</span><span style="color:#E1E4E8;">({del:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">},(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">total</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//定义总共的页数</span></span>
<span class="line"><span style="color:#E1E4E8;">        pagenum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">ceil</span><span style="color:#E1E4E8;">(total</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">limits);</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//渲染列表</span></span>
<span class="line"><span style="color:#E1E4E8;">    Articledb.</span><span style="color:#B392F0;">findArticle</span><span style="color:#E1E4E8;">({del:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">},{},{limit:limits,skip:skips,sort:{addtime:</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">}},(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">docs</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Not Found：&#39;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">err);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }   </span><span style="color:#6A737D;">//查询成功..</span></span>
<span class="line"><span style="color:#E1E4E8;">        res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index-blog.html&#39;</span><span style="color:#E1E4E8;">,{docs,pagenum});</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//博客详情</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/detail&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index-blog-detail.html&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//联系我们</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/contact&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index-contact.html&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//关于我们</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/about&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index-about.html&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> router;</span></span>
<span class="line"><span style="color:#E1E4E8;">app引入ArticleRouter.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> articleRouter </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./ArticleRouter.js&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/blog&#39;</span><span style="color:#E1E4E8;">, articleRouter)   </span><span style="color:#6A737D;">// articleRouter的每个路由都得添加一个blog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">express</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;express&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> router </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> express.</span><span style="color:#6F42C1;">Router</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Articledb</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;../models/Articledb.js&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//博客首页</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    Articledb.</span><span style="color:#6F42C1;">findArticle</span><span style="color:#24292E;">({del:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">},{},{limit:</span><span style="color:#005CC5;">9</span><span style="color:#24292E;">,sort:{addtime:</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">}},(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">docs</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> res.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Not Found：&#39;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">err);</span></span>
<span class="line"><span style="color:#24292E;">        }   </span><span style="color:#6A737D;">//查询成功..</span></span>
<span class="line"><span style="color:#24292E;">        res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;index-index.html&#39;</span><span style="color:#24292E;">,{docs})</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//博客列表页</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/lists/:pid&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//定义每页显示的条数</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> limits </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//定义每页跳过多少条</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> skips </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (req.params.pid</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">limits;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//查询条数</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> pagenum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    Articledb.</span><span style="color:#6F42C1;">findCount</span><span style="color:#24292E;">({del:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">},(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">total</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//定义总共的页数</span></span>
<span class="line"><span style="color:#24292E;">        pagenum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">ceil</span><span style="color:#24292E;">(total</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">limits);</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//渲染列表</span></span>
<span class="line"><span style="color:#24292E;">    Articledb.</span><span style="color:#6F42C1;">findArticle</span><span style="color:#24292E;">({del:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">},{},{limit:limits,skip:skips,sort:{addtime:</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">}},(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">docs</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> res.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Not Found：&#39;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">err);</span></span>
<span class="line"><span style="color:#24292E;">        }   </span><span style="color:#6A737D;">//查询成功..</span></span>
<span class="line"><span style="color:#24292E;">        res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;index-blog.html&#39;</span><span style="color:#24292E;">,{docs,pagenum});</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//博客详情</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/detail&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;index-blog-detail.html&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//联系我们</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/contact&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;index-contact.html&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//关于我们</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/about&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;index-about.html&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> router;</span></span>
<span class="line"><span style="color:#24292E;">app引入ArticleRouter.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> articleRouter </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./ArticleRouter.js&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/blog&#39;</span><span style="color:#24292E;">, articleRouter)   </span><span style="color:#6A737D;">// articleRouter的每个路由都得添加一个blog</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h2 id="七、渲染页面" tabindex="-1">七、渲染页面 <a class="header-anchor" href="#七、渲染页面" aria-label="Permalink to &quot;七、渲染页面&quot;">​</a></h2><p>（1）定义查询数据库</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">findArticle</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">conditions</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">projection</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">callback</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    models.</span><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;">(conditions,projection,options,(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">docs</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//查询失败;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(err,[])</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">{   </span><span style="color:#6A737D;">//查询成功</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">,docs);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">findArticle</span><span style="color:#24292E;">(</span><span style="color:#E36209;">conditions</span><span style="color:#24292E;">,</span><span style="color:#E36209;">projection</span><span style="color:#24292E;">,</span><span style="color:#E36209;">options</span><span style="color:#24292E;">,</span><span style="color:#E36209;">callback</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    models.</span><span style="color:#6F42C1;">find</span><span style="color:#24292E;">(conditions,projection,options,(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">docs</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//查询失败;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(err,[])</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{   </span><span style="color:#6A737D;">//查询成功</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,docs);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>（2）渲染到页面</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Articledb.</span><span style="color:#B392F0;">findArticle</span><span style="color:#E1E4E8;">({del:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">},{},{limit:</span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">,sort:{addtime:</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">}},(</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">docs</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(err){  </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Not Found：&#39;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">err);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }   </span><span style="color:#6A737D;">//查询成功..</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index-index.html&#39;</span><span style="color:#E1E4E8;">,{docs})</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Articledb.</span><span style="color:#6F42C1;">findArticle</span><span style="color:#24292E;">({del:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">},{},{limit:</span><span style="color:#005CC5;">9</span><span style="color:#24292E;">,sort:{addtime:</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">}},(</span><span style="color:#E36209;">err</span><span style="color:#24292E;">,</span><span style="color:#E36209;">docs</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(err){  </span><span style="color:#6A737D;">//查询失败</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> res.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Not Found：&#39;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">err);</span></span>
<span class="line"><span style="color:#24292E;">    }   </span><span style="color:#6A737D;">//查询成功..</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;index-index.html&#39;</span><span style="color:#24292E;">,{docs})</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过ejs模板引擎来循环，将数据发送过去；</p><h2 id="八、设计列表页" tabindex="-1">八、设计列表页 <a class="header-anchor" href="#八、设计列表页" aria-label="Permalink to &quot;八、设计列表页&quot;">​</a></h2><ol><li>计算出数据库总的页数，之后设计path路径或查询字符串；</li></ol><p>使用model.countDcuments(data,callback);</p><ol start="2"><li>通过limit和skip定义每页显示的条数，并计算出总的页数；</li></ol><p>方法：(页数-1)*条数；</p><ol start="3"><li>在前端页面通过for循环渲染页数；</li></ol><h2 id="九、登录页面" tabindex="-1">九、登录页面 <a class="header-anchor" href="#九、登录页面" aria-label="Permalink to &quot;九、登录页面&quot;">​</a></h2><ol><li>将输入的用户名调用到后台数据库查询，判断传入的数据的长度是否为0；</li><li>当账号正确之后验证密码是否正确，正确之后开始设置session；</li><li>渲染页面msg提示信息页面；</li></ol><h2 id="十、用户首页" tabindex="-1">十、用户首页 <a class="header-anchor" href="#十、用户首页" aria-label="Permalink to &quot;十、用户首页&quot;">​</a></h2><ol><li>判断sessionid是否存在，如果不存在，则跳转到提示页面，让用户登录；</li><li>利用session获取当前的用户，并使用查询数据库；</li><li>将当前用户发表的文章渲染到当前用户的首页；</li></ol><p>技巧：渲染页面时可以做一个表格，给每一行添加一个修改和删除的按钮；</p><h2 id="十一、修改文章" tabindex="-1">十一、修改文章 <a class="header-anchor" href="#十一、修改文章" aria-label="Permalink to &quot;十一、修改文章&quot;">​</a></h2><ol><li>点击修改用path路径给后台传入一个_id，后台利用_id查询数据；</li><li>设计两个路由和添加修改文章的页面；</li><li>将获取到的_id的数据渲染到页面（先显示，后修改），并添加一个隐藏域_id，添加一个图片显示的标签；</li><li>将发表文章的js内容复制到修改文章，将创建文章改成findByIdAndUpdate()；</li><li>修改失败回到修改页面，需要将id传到path路径；</li></ol><h2 id="十二、删除文章" tabindex="-1">十二、删除文章 <a class="header-anchor" href="#十二、删除文章" aria-label="Permalink to &quot;十二、删除文章&quot;">​</a></h2><ol><li>设计一个调用ajax的函数，将点击的_id传到后台；</li><li>在后台将收到的_id的值改为逻辑删除；</li></ol><h2 id="十三、文章详情页面" tabindex="-1">十三、文章详情页面 <a class="header-anchor" href="#十三、文章详情页面" aria-label="Permalink to &quot;十三、文章详情页面&quot;">​</a></h2><ol><li>点击之后将_id通过ajax传到后台，将内容显示出来；</li></ol>`,66),e=[o];function r(c,t,E,y,i,b){return n(),a("div",null,e)}const u=s(p,[["render",r]]);export{F as __pageData,u as default};
